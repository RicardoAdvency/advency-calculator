<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scroll Film 3D + Fotos</title>
  <style>
    :root { --bg:#07090d; --fg:#e9eef7; --muted:#93a4bd; }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;}
    body{background:var(--bg); color:var(--fg); overflow-x:hidden;}

    /* 3D pinned */
    #stage{ position:fixed; inset:0; z-index:2; pointer-events:none; }
    canvas{display:block; width:100%; height:100%}

    /* Photo backdrops */
    .backdrops{ position:fixed; inset:0; z-index:0; }
    .bg{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      opacity:0;
      transform: scale(1.03);
      transition: opacity 320ms linear, transform 900ms ease;
      filter: saturate(1.05) contrast(1.06);
    }
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(60% 55% at 50% 45%, rgba(0,0,0,0) 35%, rgba(0,0,0,.68) 100%),
        linear-gradient(to top, rgba(0,0,0,.78) 0%, rgba(0,0,0,.18) 55%, rgba(0,0,0,.62) 100%);
    }
    .bg.active{ opacity:1; transform: scale(1.00); }

    /* Per-scene framing (para que se sienta “otra toma” aunque sea la misma foto) */
    #bg1{ background-position: 50% 65%; }
    #bg2{ background-position: 55% 45%; }
    #bg3{ background-position: 45% 55%; filter: saturate(1.1) contrast(1.1) brightness(.95); }
    #bg4{ background-position: 60% 40%; filter: saturate(1.05) contrast(1.12); }

    /* Content */
    .wrap{ position:relative; z-index:3; }
    section{ min-height:100vh; display:flex; align-items:flex-end; padding: clamp(18px, 4vw, 56px); }
    .card{
      width:min(720px, 92vw);
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,12,16,.55);
      backdrop-filter: blur(10px);
      padding: clamp(16px, 2.4vw, 28px);
    }
    .kicker{letter-spacing:.14em; text-transform:uppercase; font-size:12px; color:var(--muted);}
    h1{margin:.45rem 0 .6rem; font-size: clamp(28px, 5vw, 56px); line-height:1.03;}
    p{margin:0; color:rgba(233,238,247,.84); font-size: clamp(14px, 2.2vw, 18px); line-height:1.5;}
    .hint{
      position:fixed; left:24px; bottom:18px; z-index:4;
      color:rgba(233,238,247,.65); font-size:12px;
      border:1px solid rgba(255,255,255,.10);
      padding:10px 12px; background:rgba(10,12,16,.45);
      backdrop-filter: blur(10px);
    }
  </style>
</head>

<body>
  <div class="backdrops">
    <div class="bg active" id="bg1"></div>
    <div class="bg" id="bg2"></div>
    <div class="bg" id="bg3"></div>
    <div class="bg" id="bg4"></div>
  </div>

  <div id="stage"></div>
  <div class="hint">Scroll ↓ (fotos + shots 3D)</div>

  <div class="wrap">
    <section id="s1">
      <div class="card">
        <div class="kicker">Scene 01 — Instalación real</div>
        <h1>Puerto Rico real</h1>
        <p>Abre con credibilidad: paneles reales, vibe local.</p>
      </div>
    </section>

    <section id="s2">
      <div class="card">
        <div class="kicker">Scene 02 — Lifestyle</div>
        <h1>El resultado</h1>
        <p>Casa / estilo de vida. Aquí vendes la transformación.</p>
      </div>
    </section>

    <section id="s3">
      <div class="card">
        <div class="kicker">Scene 03 — Tech</div>
        <h1>Energía fluyendo</h1>
        <p>Transición abstracta: “energía inteligente”.</p>
      </div>
    </section>

    <section id="s4">
      <div class="card">
        <div class="kicker">Scene 04 — Cierre</div>
        <h1>Agenda tu evaluación</h1>
        <p>Shot limpio + CTA (WhatsApp / formulario).</p>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js";
    gsap.registerPlugin(ScrollTrigger);

    // ✅ TUS FOTOS (locales)
    const CASA = "assets/casa.jpg";
    const PANELES = "assets/paneles.jpg";

    // Scene mapping (4 escenas usando 2 fotos)
    const IMG_1 = PANELES; // s1
    const IMG_2 = CASA;    // s2
    const IMG_3 = PANELES; // s3
    const IMG_4 = CASA;    // s4

    const bgs = [
      document.getElementById("bg1"),
      document.getElementById("bg2"),
      document.getElementById("bg3"),
      document.getElementById("bg4"),
    ];
    [IMG_1, IMG_2, IMG_3, IMG_4].forEach((src, i) => {
      bgs[i].style.backgroundImage = `url('${src}')`;
    });

    // Switch background by section
    ["#s1", "#s2", "#s3", "#s4"].forEach((sel, i) => {
      ScrollTrigger.create({
        trigger: sel,
        start: "top 55%",
        end: "bottom 45%",
        onEnter: () => setActive(i),
        onEnterBack: () => setActive(i),
      });
    });
    function setActive(i){
      bgs.forEach((el, idx) => el.classList.toggle("active", idx === i));
    }

    // 3D
    const mount = document.getElementById("stage");
    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.05;
    mount.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(40, innerWidth/innerHeight, 0.1, 200);
    camera.position.set(0, 1.2, 6);

    const key = new THREE.DirectionalLight(0xffffff, 2.2); key.position.set(4, 6, 3); scene.add(key);
    const fill = new THREE.DirectionalLight(0x88aaff, 0.9); fill.position.set(-5, 2, 2); scene.add(fill);
    const rim = new THREE.DirectionalLight(0xffffff, 1.4); rim.position.set(-2, 4, -6); scene.add(rim);
    scene.add(new THREE.AmbientLight(0x223344, 0.65));

    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(50, 50),
      new THREE.MeshStandardMaterial({ color: 0x0b0f18, roughness: 0.35, metalness: 0.05 })
    );
    floor.rotation.x = -Math.PI/2;
    floor.position.y = -0.9;
    scene.add(floor);

    // Placeholder “product” (luego lo cambiamos por un modelo GLB)
    const group = new THREE.Group(); scene.add(group);

    const body = new THREE.Mesh(
      new THREE.BoxGeometry(2.8, 0.7, 1.2),
      new THREE.MeshStandardMaterial({ color: 0x4aa3ff, metalness: 0.6, roughness: 0.2 })
    );
    body.position.y = -0.1;

    const cabin = new THREE.Mesh(
      new THREE.BoxGeometry(1.4, 0.55, 1.05),
      new THREE.MeshStandardMaterial({ color: 0x111319, metalness: 0.2, roughness: 0.15 })
    );
    cabin.position.set(0.2, 0.35, 0);

    const wheelGeo = new THREE.CylinderGeometry(0.28, 0.28, 0.22, 24);
    const wheelMat = new THREE.MeshStandardMaterial({ color:0x0a0a0a, metalness:0.2, roughness:0.6 });
    const wheel = (x,z) => {
      const w = new THREE.Mesh(wheelGeo, wheelMat);
      w.rotation.z = Math.PI/2;
      w.position.set(x, -0.45, z);
      return w;
    };
    group.add(body, cabin, wheel(-1.05, 0.55), wheel(1.05, 0.55), wheel(-1.05, -0.55), wheel(1.05, -0.55));
    scene.fog = new THREE.FogExp2(0x07090d, 0.085);

    addEventListener("resize", () => {
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });

    const clock = new THREE.Clock();
    function tick(){
      const t = clock.getElapsedTime();
      group.rotation.y += 0.002;
      group.position.y = Math.sin(t*0.9)*0.02;
      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
    tick();

    // Cinematic shots
    const shots = gsap.timeline({
      scrollTrigger:{ trigger: ".wrap", start:"top top", end:"bottom bottom", scrub:1 }
    });

    shots.to(camera.position, { x:0,   y:1.2, z:6,   duration:1 }, 0)
         .to(group.rotation,  { y:0.6,        duration:1 }, 0)

         .to(camera.position, { x:1.3, y:0.9, z:2.9, duration:1 }, 1)
         .to(group.rotation,  { y:1.5,        duration:1 }, 1)

         .to(camera.position, { x:-2.2,y:1.0, z:4.2, duration:1 }, 2)
         .to(group.rotation,  { y:2.35,       duration:1 }, 2)

         .to(camera.position, { x:0.2, y:1.35,z:5.2, duration:1 }, 3)
         .to(group.rotation,  { y:3.2,        duration:1 }, 3);

    // Caption fade
    document.querySelectorAll("section .card").forEach((el) => {
      gsap.fromTo(el, { autoAlpha:0, y:22 }, {
        autoAlpha:1, y:0,
        scrollTrigger:{ trigger: el.parentElement, start:"top 70%", end:"top 35%", scrub:true }
      });
    });
  </script>
</body>
</html>
